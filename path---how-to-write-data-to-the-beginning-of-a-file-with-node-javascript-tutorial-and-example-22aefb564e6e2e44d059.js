webpackJsonp([0xce03a33f422d],{363:function(e,t){e.exports={data:{markdownRemark:{html:'<p>Recently I have had to do a lot of work building infrastructure converting data from <code>.json</code> to <code>.csv</code>. One challenge that presented itself was figuring out a way to prepend / write data to the beginning of the <code>.csv</code> file. There are plenty of use cases for prepending information to the beginning of a file, however in my specific use case I needed to count the number of times a variable existed in the <code>.json</code> data so that I could write out that many columns in the header of the <code>.csv</code> file.</p>\n<p>The example below creates a <code>.csv</code> file using data extracted from a <code>.json</code> file via Node.js / JavaScript and then writes the header once the desired counts have been determined. To do so, we must first create a temporary file with the converted data (left), create a new file with the generated header (middle), then copy data from the temporary file into the new file (right).</p>\n<h3>Part 1 - Variable setup</h3>\n<p>We will begin by setting up the variables and functions needed for the task at hand. The header functions have been abstracted and should be written for your specific need(s). Additionally, loading up the entire <code>.json</code> file into memory as depicted in this example has been used for simplicity; implementation of a readstream for reading the <code>.json</code> file would improve performance and allow you to read a larger file.</p>\n<pre><code class="language-javascript">// your .json data\nvar dataArrayJson = [{},{},...,{},{}];\n// count of the desired variable\nvar count = 0;\n\n// your desired function that converts the json data into a .csv row\nvar convertIntoCsvString = function(data){ return youCsvString; };\n// your desired function that counts the number of times something occurs in the dataset\nvar getCount = function(data){ return dataCount; };\n\n// your desired function that creates a row using the variable count\n// i.e. returns something like \'Count-1,Count-2,Count-3\' if the count is 3\nvar createCsvHeaderUsingCount = function(count){ return header; };\n\n// create the writestream for the temporary file\nvar streamOptions = {flags: \'w\', encoding: \'utf8\'};\nvar writeStream = fs.createWriteStream("csvFilename-tmp.csv", streamOptions);\n</code></pre>\n<h3>Part 2 - <code>.json</code> to <code>.csv</code> conversion</h3>\n<p>Once we have the <code>.json</code> data loaded up, we will convert each index in the json array into a comma separated row using our <code>convertIntoCsvString</code> function, add a newline to the end of the row, and write the row to our temporary file <code>csvFilename-tmp.csv</code> using <code>fs.writestream</code>. Additionally, use our <code>getCount</code> function to track how often our deisred event or instance occurs.</p>\n<p>Note, some version of <code>async.each</code> should be used to ensure that all the data has been analyzed at and written to the <code>.csv</code> file prior to closing the writestream. If the order of data analysis is significant and there is risk of race conditions to occur, <code>async.eachSeries</code> should be used.</p>\n<pre><code class="language-javascript">// loop over each object in the .json data\n// the specified limit of 5 is arbitrary but eachLimit is recommended\nasync.eachLimit(dataArrayJson, 5, function(data, dataCb) {\n  var row = convertIntoCsvString(data);\n  count = Math.max( count, getCount(data) );\n\n  // write the `.csv` row to the temporary file as a new row\n  writeStream.write( row + "\\n", \'utf8\', function() {\n    return dataCb();\n  });\n}, function(err){\n  // close the writestream once done looping through the .json\n  // note: async library ensures we have analyzed all the data\n  writeStream.close();\n});\n</code></pre>\n<h3>Part 3 - Header creation</h3>\n<p>With the desired information in hand, we can now create the custom header using createCsvHeaderUsingCount. The data is read from the temporary file <code>csvFilename-tmp.csv</code>, our header is prepended to this data, and our desired file csvFilename<code>.csv</code> is created. We delete the temporary file using a child process and then are left with our shiny new file ready for consumption.</p>\n<pre><code class="language-javascript">var header = createCsvHeaderUsingCount(count);\nfs.readFile("csvFilename-tmp.csv", function(err, data) {\n  data = header + \'\\n\' + data;\n  var newWriteStream = fs.createWriteStream("csvFilename.csv", streamOptions);\n  newWriteStream.write(data, \'utf8\', function() {\n    // remove the temporary file\n    childProcess.exec("rm -rf csvFilename-tmp.csv");\n  });\n});\n</code></pre>\n<h3>Uncommented code</h3>\n<p>Below is the code above condensed with comments removed.</p>\n<pre><code class="language-javascript">var dataArrayJson = [{},{},...,{},{}];\n\nvar convertIntoCsvString = function(data){ return youCsvString; };\nvar getCount = function(data){ return dataCount; };\nvar createCsvHeaderUsingCount = function(count){ return header; };\n\nvar count = 0;\n\nvar streamOptions = {flags: \'w\', encoding: \'utf8\'};\nvar writeStream = fs.createWriteStream("csvFilename-tmp.csv", streamOptions);\nasync.eachLimit(dataArrayJson, 5, function(data, dataCb) {\n  var row = convertIntoCsvString(data);\n  count = Math.max( count, getCount(data) );\n  writeStream.write( row + "\\n", \'utf8\', function() {\n    return dataCb();\n  });\n}, function(err){\n  writeStream.close();\n});\n\nvar header = createCsvHeaderUsingCount(count);\nfs.readFile("csvFilename-tmp.csv", function(err, data) {\n  data = header + \'\\n\' + data;\n  var newWriteStream = fs.createWriteStream("csvFilename.csv", streamOptions);\n  newWriteStream.write(data, \'utf8\', function() {\n    childProcess.exec("rm -rf csvFilename-tmp.csv");\n  });\n});\n</code></pre>',frontmatter:{date:"1435647600000",path:"/how-to-write-data-to-the-beginning-of-a-file-with-node-javascript-tutorial-and-example",title:"How to write data to the beginning of a file with Node.js / JavaScript (tutorial and example)"}}},pathContext:{}}}});
//# sourceMappingURL=path---how-to-write-data-to-the-beginning-of-a-file-with-node-javascript-tutorial-and-example-22aefb564e6e2e44d059.js.map