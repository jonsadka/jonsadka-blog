{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/how-to-export-photoshop-images-at-custom-resolutions-using-javacript-scripting","result":{"data":{"markdownRemark":{"html":"<h3>Goal</h3>\n<p>For a recent project, a goal was set to improve page load times on mobile devices. One quick win was to develop images at varying breakpoints and load the smallest viable image using <code>srcset</code> attributes on <code>&#x3C;image></code> tags instead of loading the same full-resolution image for all devices.</p>\n<p>I thought exporting an image at specific breakpoint widths like <code>640px, 1024px, 1440px</code> using Photoshop would be quick and easy but Photoshop's <code>Export As</code> option only supports exporting at pre-defined scale multipliers like <code>0.3x, 1x, 2x</code> [Figure 1]. Additionally, even if Photoshop's <code>Export As</code> option supported specifying breakpoint widths, exporting dozens of images one-at-a-time would prove cumbersome.</p>\n<p><img src=\"/img/blog-posts/2019-17-12-how-to-export-photoshop/photoshop-resize-options.png\" alt=\"Photoshop Scale Options\" title=\"Photoshop Scale Options\">\n<em>Figure 1. Photoshop Scale Options</em></p>\n<h3>Solution</h3>\n<p>Luckily, Adobe makes available a nifty scripting feature called Adobe Photoshop Scripting (<a href=\"https://helpx.adobe.com/photoshop/using/scripting.html\" target=\"_blank\" rel=\"noreferrer noopener\">about article</a>, <a href=\"https://www.adobe.com/devnet/photoshop/scripting.html\" target=\"_blank\" rel=\"noreferrer noopener\">documentation</a>) which supports scripting in AppleScript, JavaScript and VBScript. We can achieve resizing at various breakpoints using Photoshop Scripting! For this post, we will be using JavaScript, but this method would work across all scripting languages.</p>\n<h3>Methodology</h3>\n<p>The methodology below, of copying and pasting a selection instead of the layer itself, allows the position of the image to be preserved when resizing. If the original layer was copied and resized, the image would be scaled based on its anchor point which is not always in the center and would result in a shifted image [Figure 2].</p>\n<p><img src=\"/img/blog-posts/2019-17-12-how-to-export-photoshop/photoshop-layer-offset.png\" alt=\"photoshop-layer-offset-issue\" title=\"photoshop-layer-offset-issue\">\n<em>Figure 2</em></p>\n<h3>Script Walkthrough</h3>\n<p><strong>*NOTE:</strong> Creating this script took me a couple hours and is just one example solution; there are various ways to achieve resizing using scripting.</p>\n<p>First, create your script file using the <code>.jsx</code> extension (i.e. <code>resize.jsx</code>) as recommended by Adobe. At the very top, we will start our script by creating a reference to the original Photoshop document. This enables us to reference it when our focus is on another document.</p>\n<pre><code>const docRef = app.activeDocument;\n</code></pre>\n<p>Set your desired unit and disable clipboard copying; all the work we are doing lives within Photoshop and does not need to be pasted elsewhere. This should help prevent your memory from blowing up.</p>\n<pre><code>app.preferences.rulerUnits = Units.PIXELS;\napp.preferences.exportClipboard = false;\n</code></pre>\n<p>Grab all the layers in your photoshop file and set your desired resolutions widths</p>\n<pre><code>const layers = docRef.layers;\nconst resolutions = [320, 640, 1125, 1440, 1600, 1920, 2560];\n</code></pre>\n<p>Next, we will setup a loop which will iterate over each layer and generate that image at each resolution.</p>\n<pre><code>for (var layerIndex = 0; layerIndex &#x3C; layers.length; layerIndex++) {\n  // Set a reference to the layer\n  var layer = layers[layerIndex];\n\n  // Toggle the layer as visible before copying it to the clipboard\n  layer.visible = true;\n\n  // Generate an image for each desired resolution\n  for (var sizeIdx = 0; sizeIdx &#x3C; resolutions.length; sizeIdx++) {\n    var resolution = resolutions[sizeIdx];\n    generateNewImage(layer, resolution);\n  }\n\n  // Bring to focus the original document\n  app.activeDocument = docRef;\n\n  // Reset the selection\n  docRef.selection.deselect();\n\n  // Toggle the layer as visiblity off to prepare for the next image\n  layer.visible = false;\n}\n</code></pre>\n<p>Stepping into the <code>generateNewImage</code> function, calculate the new image size and resize the canvas based on the desired width.</p>\n<pre><code>function generateNewImage(layerRef, desiredSize) {\n  // Calculate the new image size\n  var resizePercent = (desiredSize / docRef.width) * 100;\n  var width = Math.floor((docRef.width * resizePercent) / 100);\n  var height = Math.floor((docRef.height * resizePercent) / 100);\n\n  ...\n}\n</code></pre>\n<p>Next, create a selection across the entire artboard, from top to bottom, right to left and then copy the content container within that selection.</p>\n<pre><code>function generateNewImage(layerRef, desiredSize) {\n  ...\n\n  // Select the artboard so that we can propertly rescale the images\n  docRef.selection.select([\n    [0, 0],                        [0, docRef.height],\n    [docRef.width, docRef.height], [docRef.width, 0],\n  ]);\n  // Copy the content\n  docRef.selection.copy(true);\n\n  ...\n}\n</code></pre>\n<p>Once the content has been selected, we will create a new document using the name of the layer and append the width as a suffix. NOTE: If you generate names in this manner, you must ensure unique layer names so that one does not overwrite the other.</p>\n<pre><code>function generateNewImage(layerRef, desiredSize) {\n  ...\n\n  // Create a new document\n  var documentName = layerRef.name + '-' + width + 'w';\n  newDocument = documents.add(\n    docRef.width, // width\n    docRef.height, // height\n    300, // resolution\n    documentName, // name\n    NewDocumentMode.RGB, // mode\n    DocumentFill.TRANSPARENT, // initialFill\n    1, // pixelAspectRatio\n    BitsPerChannelType.SIXTEEN // bitsPerChannel\n  );\n\n  ...\n}\n</code></pre>\n<p>Upon creation of this document, shift focus to the new document, paste the image as a new layer.</p>\n<pre><code>function generateNewImage(layerRef, desiredSize) {\n  ...\n\n  // Set the active document as the one we just made\n  app.activeDocument = newDocument;\n  // Paste the copied content\n  newDocument.paste();\n\n  ...\n}\n</code></pre>\n<p>Resize the canvas and the layer, setting the anchor position as the middle-center for both to ensure the content scales at the same rate as the canvas.</p>\n<pre><code>function generateNewImage(layerRef, desiredSize) {\n  ...\n\n  // Resize the canvas\n  newDocument.resizeCanvas(width, height, AnchorPosition.MIDDLECENTER);\n  // Resize the layer\n  var newLayer = newDocument.layers[0];\n  newLayer.name = documentName;\n  newLayer.resize(resizePercent, resizePercent, AnchorPosition.MIDDLECENTER);\n\n  ...\n}\n</code></pre>\n<p>Last, save the new image using the native Photoshop save command or save using the web implementation, close the document, and restore focus back to the original document.</p>\n<pre><code>function generateNewImage(layerRef, desiredSize) {\n  ...\n\n\n  // Save the image\n  saveJpeg(documentName, {quality: 9}, '-native-9');\n\n  // Save the image for web\n  saveJpegForWeb(documentName, {quality: 68}, '-web-68');\n\n  // Close the document\n  newDocument.close(SaveOptions.DONOTSAVECHANGES);\n\n  // Restore focus back to the original document\n  app.activeDocument = docRef;\n}\n</code></pre>\n<p>The save functions are quite simple and can be modified as you see fit</p>\n<pre><code>function saveJpeg(name, options, suffix) {\n  const doc = app.activeDocument;\n  const file = new File('~/Desktop/resized/' + name + suffix + '.jpg');\n\n  const saveOptions = new JPEGSaveOptions();\n  saveOptions.quality = options.quality;\n  saveOptions.embedColorProfile = true;\n\n  const asCopy = true;\n  doc.saveAs(file, saveOptions, asCopy, Extension.LOWERCASE);\n}\n\nfunction saveJpegForWeb(name, options, suffix) {\n  const doc = app.activeDocument;\n  const file = new File('~/Desktop/resized/' + name + suffix + '.jpg');\n\n  saveOptions = new ExportOptionsSaveForWeb();\n  saveOptions.format = SaveDocumentType.JPEG;\n  saveOptions.includeProfile = false;\n  saveOptions.interlaced = false;\n  saveOptions.optimized = true;\n  saveOptions.quality = options.quality;\n\n  doc.exportDocument(file, ExportType.SAVEFORWEB, saveOptions);\n}\n</code></pre>\n<p>Once were all wrapped up, we iterate over all the layers one last time and restore their visibilities.</p>\n<pre><code>for (var layerIndex = 0; layerIndex &#x3C; layers.length; layerIndex++) {\n  // Set a reference to the layer\n  var layer = layers[layerIndex];\n  // Restore the layer visibility\n  layer.visible = true;\n}\n</code></pre>\n<h3>Complete Script</h3>\n<p>The completed script below</p>\n<pre><code>const docRef = app.activeDocument;\napp.preferences.rulerUnits = Units.PIXELS;\napp.preferences.exportClipboard = false;\n\nconst layers = docRef.layers;\nconst resolutions = [320, 640, 1125, 1440, 1600, 1920, 2560];\n\nfor (var layerIndex = 0; layerIndex &#x3C; layers.length; layerIndex++) {\n  // Set a reference to the layer\n  var layer = layers[layerIndex];\n\n  // Toggle the layer as visible before copying it to the clipboard\n  layer.visible = true;\n\n  // Generate an image for each desired resolution\n  for (var sizeIdx = 0; sizeIdx &#x3C; resolutions.length; sizeIdx++) {\n    var resolution = resolutions[sizeIdx];\n    generateNewImage(layer, resolution);\n  }\n\n  // Bring to focus the original document\n  app.activeDocument = docRef;\n\n  // Reset the selection\n  docRef.selection.deselect();\n\n  // Toggle the layer as visiblity off to prepare for the next image\n  layer.visible = false;\n}\n\nfor (var layerIndex = 0; layerIndex &#x3C; layers.length; layerIndex++) {\n  // Set a reference to the layer\n  var layer = layers[layerIndex];\n  // Restore the layer visibility\n  layer.visible = true;\n}\n\nfunction generateNewImage(layerRef, desiredSize) {\n  // Calculate the new image size\n  var resizePercent = (desiredSize / docRef.width) * 100;\n  var width = Math.floor((docRef.width * resizePercent) / 100);\n  var height = Math.floor((docRef.height * resizePercent) / 100);\n\n  // Select the artboard so that we can propertly rescale the images\n  docRef.selection.select([\n    [0, 0],                        [0, docRef.height],\n    [docRef.width, docRef.height], [docRef.width, 0],\n  ]);\n\n  // Copy the content\n  docRef.selection.copy(true);\n\n  // Create a new document\n  var documentName = layerRef.name + '-' + width + 'w';\n  newDocument = documents.add(\n    docRef.width, // width\n    docRef.height, // height\n    300, // resolution\n    documentName, // name\n    NewDocumentMode.RGB, // mode\n    DocumentFill.TRANSPARENT, // initialFill\n    1, // pixelAspectRatio\n    BitsPerChannelType.SIXTEEN // bitsPerChannel\n  );\n\n  // Set the active document as the one we just made\n  app.activeDocument = newDocument;\n  // Paste the copied content\n  newDocument.paste();\n\n  // Resize the canvas\n  newDocument.resizeCanvas(width, height, AnchorPosition.MIDDLECENTER);\n  // Resize the layer\n  var newLayer = newDocument.layers[0];\n  newLayer.name = documentName;\n  newLayer.resize(resizePercent, resizePercent, AnchorPosition.MIDDLECENTER);\n\n  // Save the image\n  saveJpeg(documentName, {quality: 9}, '-native-9');\n\n  // Save the image for web\n  saveJpegForWeb(documentName, {quality: 68}, '-web-68');\n\n  // Close the document\n  newDocument.close(SaveOptions.DONOTSAVECHANGES);\n\n  // Restore focus back to the original document\n  app.activeDocument = docRef;\n}\n\nfunction saveJpeg(name, options, suffix) {\n  const doc = app.activeDocument;\n  const file = new File('~/Desktop/resized/' + name + suffix + '.jpg');\n\n  const saveOptions = new JPEGSaveOptions();\n  saveOptions.quality = options.quality;\n  saveOptions.embedColorProfile = true;\n\n  const asCopy = true;\n  doc.saveAs(file, saveOptions, asCopy, Extension.LOWERCASE);\n}\n\nfunction saveJpegForWeb(name, options, suffix) {\n  const doc = app.activeDocument;\n  const file = new File('~/Desktop/resized/' + name + suffix + '.jpg');\n\n  saveOptions = new ExportOptionsSaveForWeb();\n  saveOptions.format = SaveDocumentType.JPEG;\n  saveOptions.includeProfile = false;\n  saveOptions.interlaced = false;\n  saveOptions.optimized = true;\n  saveOptions.quality = options.quality;\n\n  doc.exportDocument(file, ExportType.SAVEFORWEB, saveOptions);\n}\n</code></pre>","frontmatter":{"date":"1576569600000","path":"/blog/how-to-export-photoshop-images-at-custom-resolutions-using-javacript-scripting","title":"How to export Photoshop images at custom resolutions using Adobe Photoshop Scripting and JavaScript"}}},"pageContext":{}}}