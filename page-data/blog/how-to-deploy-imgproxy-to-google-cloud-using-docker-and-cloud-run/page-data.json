{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/how-to-deploy-imgproxy-to-google-cloud-using-docker-and-cloud-run","result":{"data":{"markdownRemark":{"html":"<h3>Goal</h3>\n<p>Be able to host a production instance of imgproxy on Google Cloud within minutes.</p>\n<h3>First time installation</h3>\n<ol>\n<li>\n<p>Open the Cloud Terminal</p>\n</li>\n<li>\n<p>Follow the <code>Before you begin</code> section listed here (<a href=\"https://cloud.google.com/container-registry/docs/pushing-and-pulling\">https://cloud.google.com/container-registry/docs/pushing-and-pulling</a>)</p>\n<ul>\n<li><code>$ sudo usermod -a -G docker ${USER}</code></li>\n<li><code>$ gcloud auth configure-docker</code></li>\n</ul>\n</li>\n<li>\n<p>Pull the latest docker image (<a href=\"https://docs.imgproxy.net/#/installation\">https://docs.imgproxy.net/#/installation</a>)</p>\n<ul>\n<li><code>$ docker pull darthsim/imgproxy:latest</code></li>\n</ul>\n</li>\n<li>\n<p>Tag the container</p>\n<ul>\n<li><code>$ docker tag darthsim/imgproxy gcr.io/xxxxx-public-assets/imgproxy</code></li>\n</ul>\n</li>\n<li>\n<p>Push the container</p>\n<ul>\n<li><code>$ docker push gcr.io/xxxxx-public-assets/imgproxy</code></li>\n<li>Copy the sha (i.e. <code>sha256:12345...54321</code>)</li>\n</ul>\n</li>\n<li>\n<p>Head to <code>Cloud Run</code></p>\n</li>\n<li>\n<p>Create Service</p>\n<ul>\n<li>Enter your service name (i.e. <code>xxxxx-imgproxy-production</code>)</li>\n<li>Click <code>Allow unauthenticated invocations</code></li>\n<li>Hit Next, click <code>Select</code> on the input and search for the desired image\n<ul>\n<li>Alternatively, manually build the url and paste the sha (or <code>gcr.io/xxxxx-public-assets/imgproxy@sha256:12345...54321</code>)</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>Add any environment variables like <code>IMGPROXY_KEY</code> and <code>IMGPROXY_SALT</code></p>\n<ul>\n<li>See <a href=\"https://cloud.google.com/run/docs/configuring/environment-variables\">https://cloud.google.com/run/docs/configuring/environment-variables</a></li>\n</ul>\n</li>\n</ol>\n<h3>Updating the image</h3>\n<ol>\n<li>\n<p>Open the Cloud Terminal</p>\n</li>\n<li>\n<p>Follow the <code>Before you begin</code> section listed here (<a href=\"https://cloud.google.com/container-registry/docs/pushing-and-pulling\">https://cloud.google.com/container-registry/docs/pushing-and-pulling</a>)</p>\n<ul>\n<li><code>$ sudo usermod -a -G docker ${USER}</code></li>\n<li><code>$ gcloud auth configure-docker</code></li>\n</ul>\n</li>\n<li>\n<p>Pull the latest docker image (<a href=\"https://docs.imgproxy.net/#/installation\">https://docs.imgproxy.net/#/installation</a>)</p>\n<ul>\n<li><code>$ docker pull darthsim/imgproxy:latest</code></li>\n</ul>\n</li>\n<li>\n<p>Tag the container</p>\n<ul>\n<li><code>$ docker tag darthsim/imgproxy gcr.io/xxxxx-public-assets/imgproxy</code></li>\n</ul>\n</li>\n<li>\n<p>Push the container</p>\n<ul>\n<li><code>$ docker push gcr.io/xxxxx-public-assets/imgproxy</code></li>\n<li>Copy the sha (i.e. <code>sha256:12345...54321</code>)</li>\n</ul>\n</li>\n<li>\n<p>Head to <code>Cloud Run</code></p>\n</li>\n<li>\n<p>Click on the name of the service you wish to update (i.e. <code>xxxxx-imgproxy-production</code>)</p>\n</li>\n<li>\n<p>Click <code>Edit &#x26; Depoly New Revision</code> at the top of the page</p>\n</li>\n<li>\n<p>Slick <code>Select</code> on the input and search for the desired image</p>\n<ul>\n<li>Alternatively, manually build the url and paste the sha (or <code>gcr.io/xxxxx-public-assets/imgproxy@sha256:12345...54321</code>)</li>\n</ul>\n</li>\n</ol>","frontmatter":{"date":"1590562800000","path":"/blog/how-to-deploy-imgproxy-to-google-cloud-using-docker-and-cloud-run","title":"How to deploy imgproxy to Google Cloud using Docker and Cloud Run"}}},"pageContext":{}},"staticQueryHashes":[]}