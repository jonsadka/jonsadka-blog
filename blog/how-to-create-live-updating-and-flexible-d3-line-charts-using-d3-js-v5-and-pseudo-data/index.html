<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/component---src-templates-blog-post-js.d353a3096505d8eda03e.css">@import url(https://fonts.googleapis.com/css?family=Libre+Franklin|Questrial);html{font-family:Questrial,sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;color:#1644ce;text-decoration:none;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.45em georgia,serif;box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{color:rgba(0,0,0,.8);font-family:Questrial,georgia,serif;font-weight:400;word-wrap:break-word;-webkit-font-kerning:normal;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";-webkit-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt"}img{margin:0;padding:0}h1{margin:0 0 1.45rem;font-weight:700;font-size:2.25rem;line-height:1.1}h1,h2{padding:0;color:inherit;font-family:Questrial,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;text-rendering:optimizeLegibility}h2{font-size:28px;letter-spacing:.05rem;margin:0 0 30px}h3{font-size:1.38316rem}h3,h4{padding:0;margin:0 0 1.45rem;color:inherit;font-family:Questrial,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{padding:0;margin:0 0 1.45rem;color:inherit;font-family:Questrial,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{padding:0;margin:0 0 1.45rem}ul{margin-right:0;margin-top:0;margin-bottom:1.45rem}ol,ul{padding:0;list-style-position:outside;list-style-image:none}ol{margin:0 0 1.45rem 1.45rem}dd,dl{margin:0 0 1.45rem}dd,dl,p{padding:0}p{margin-left:0;margin-right:0;color:#a3a3a3;margin-top:30px;font-size:15px}figure{padding:0}figure,pre{margin:0 0 1.45rem}pre{font-size:.85rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{padding:0;margin:0 0 1.45rem}blockquote{padding:0;margin:0 1.45rem 1.45rem}form,iframe,noscript{padding:0;margin:0 0 1.45rem}hr,iframe{border:none}hr{padding:0;margin:0 0 calc(1.45rem - 1px);background:rgba(0,0,0,.2);height:1px}address{padding:0;margin:0 0 1.45rem}b,dt,strong,th{font-weight:700}li{color:#a3a3a3;margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{letter-spacing:-.2em;content:" "}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}img+em{display:block;text-align:center}</style><meta name="generator" content="Gatsby 2.0.28"/><style data-styled-components="jxDjQw eRhchY idJfWh">
/* sc-component-id: Header__Name-sc-1yg5ab7-0 */
.jxDjQw{font-size:14px;font-weight:700;}
/* sc-component-id: blog-post__BlogTitle-sc-1g2ojw6-0 */
.eRhchY{color:#394047;font-family:'Questrial';font-size:36px;line-height:44px;margin-bottom:1.45rem;}
/* sc-component-id: blog-post__BlogContent-sc-1g2ojw6-1 */
.idJfWh{color:#a3a3a3;line-height:20px;font-size:15px;font-family:'Questrial';} .idJfWh img{border-radius:4px;display:block;margin:10px auto;max-width:734px;width:100%;}</style><title data-react-helmet="true">Jon Sadka - How to create live updating and flexible D3.js line charts using D3.js v5 and pseudo-data (interactive tutorial and example)</title><meta data-react-helmet="true" name="description" content="Jon Sadka&#x27;s Personal Website and Blog"/><meta data-react-helmet="true" name="keywords" content="personal website, blog, sadka, jon, jon sadka, visualization, front end, software engineer, portfolio, visualization, D3.js, JavaScript"/><meta data-react-helmet="true" name="theme-color" content="#333333"/><meta data-react-helmet="true" name="google-site-verification" content="aGnf4yqfnIPW-BYUolkaPSjtVzXYAsQKR3pZAuxH7-E"/><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-53344458-1', 'auto', {});
      
      }
      </script><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#333333"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-1c631c2dcd091a6f36e2.js"/><link as="script" rel="preload" href="/0-f01ddaf1fdf10dc81c90.js"/><link as="script" rel="preload" href="/app-a383500957aa8d29ea7d.js"/><link as="script" rel="preload" href="/webpack-runtime-33cd8964d6e581f59531.js"/><link rel="preload" href="/static/d/313/path---blog-how-to-create-live-updating-and-flexible-d-3-line-charts-using-d-3-js-v-5-and-pseudo-data-352-efb-OiHq33fTSZQtYL5slABzwIx0.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div><div style="margin-bottom:1.45rem"><div style="margin:0 auto;max-width:960px;padding:1.45rem 1.0875rem"><div class="Header__Name-sc-1yg5ab7-0 jxDjQw" style="margin:0"><a style="color:black;font-family:Libre Franklin;text-decoration:none" href="/">Jon Sadka.</a></div></div></div><div style="margin:0 auto;max-width:960px;padding:0px 1.0875rem 1.45rem;padding-top:0"><div class="blog-post-container"><div class="blog-post"><div class="blog-post__BlogTitle-sc-1g2ojw6-0 eRhchY">How to create live updating and flexible D3.js line charts using D3.js v5 and pseudo-data (interactive tutorial and example)</div><div class="blog-post-content blog-post__BlogContent-sc-1g2ojw6-1 idJfWh"><p>One of the bigger challenges in visualizing data is making your charts responsive so that they can resize no matter what range of data is thrown at it. Things get even more complicated when the dataset is actually a collection of many individual sets of data. One obvious example of this is a dataset containing (x,y) coordinates for multiple lines. The goal is to create a chart similar to the one below, which adapts to any new data thrown at it.</p>
<iframe width="960" height="500" src="https://cdn.rawgit.com/jonsadka/482005612916b3f5e408/raw/7c05bc7b136a269d39e87138d745c368f69560f0/index.html" marginwidth="0" marginheight="0" scrolling="no" align="middle"></iframe>
<h3>Generate data</h3>
<p>The best way to test the functionality of your graph is to generate new pseudo-data at a set interval and update the graph at the same interval. I had previously blogged about how to generate large datasets using D3.js and JavaScript; if you are not familiar with this process, I strongly recommend that you take a quick read through that (<a href="/blog/how-to-quickly-create-randomly-generated-datasets-in-javascript-with-d3/">link</a>). For this example, we need to start by creating a function that returns a dataset comprised of (x,y) coordinates for any specified number of lines. The function below takes two arguments, the desired number of lines and the desired number of points, and returns a 2D array where each nested array is a series of (x,y) coordinates pertaining to that line. The y coordinate is multiplied by 100 to better exaggerate this example.</p>
<pre><code class="language-javascript">function newData(lineNumber, numPoints) {
  return d3.range(lineNumber).map(() =>
    d3.range(numPoints).map((item, index) =>
      ({x: index / (numPoints - 1), y: Math.random() * 100})
    )
  );
}
</code></pre>
<h3>Setup page elements</h3>
<p>Now, we can start to setup up our page elements, such as the svg dimensions, along with the margins.</p>
<pre><code class="language-javascript">const width = 960;
const height = 500;

const margin = {top: 20, right: 20, bottom: 20, left: 50};

const svg = d3.select("body").append("svg")
  .attr("height", height).attr("width", width)
  .append("g")
    .attr("transform", `translate(${margin.left}, ${margin.right})`)
</code></pre>
<p>Thinking about the scales for our x and y coordinates, we can assume that our window frame is constant. It’s good practice to make these ranges dynamic based on the page dimensions, but I will gloss over it purpose of this example. The thing to keep in mind is that although our ranges are constant, our domains will change with each generation of new data, so we will leave out our range specifications for now.</p>
<pre><code class="language-javascript">const xScale = d3.scaleLinear()
  .range([0, width - margin.left - margin.right]);

const yScale = d3.scaleLinear()
  .range([height - margin.top - margin.bottom, 0]);

const line = d3.line()
  .x(d => xScale(d.x))
  .y(d => yScale(d.y))
  .curve(d3.curveMonotoneX);
</code></pre>
<h3>Create <code>render</code> function</h3>
<p>Now what we must do is encapsulate the rest of the program in a function, which I have called <code>render()</code>, that will update our graph when a new dataset is created. When <code>render</code> is invoked, it first must generate a new collection of data and gather the absolute minimum and maximum in the dataset. This means that we need to loop through each set of data (i.e. line), compare the minimums and maximums amongst the other sets of data (i.e. other lines) and pull the most extreme ones of the collection. Once we have done that, we can specify the domain for our scales.</p>
<pre><code class="language-javascript">function render(){
  // generate new dataset
  const data = newData(9, 3);

  // obtain absolute min and max
  const yMin = data.reduce((pv,cv) => {
    const currentMin = cv.reduce((pv,cv) => Math.min(pv,cv.y), 100);
    return Math.min(pv, currentMin);
  }, 100);
  const yMax = data.reduce((pv,cv) => {
    const currentMax = cv.reduce((pv,cv) => Math.max(pv,cv.y), 0)
    return Math.max(pv, currentMax);
  }, 0);

  // set as domain for axis
  yScale.domain([yMin, yMax]);
}
</code></pre>
<p>In this example, we are not drawing an x-axis and therefore are not specifying a domain for the xScale, however the process would be extremely similar if that was desired. Now that we have our scale set for this specific set of data, we can create our y-axis within our render function.</p>
<pre><code class="language-javascript">// create axis
const yAxis = d3.axisLeft().scale(yScale);

// remove any previously drawn axis
svg.selectAll(".y.axis").remove();

// draw the new axis
svg.append("g").attr("class", "y axis").call(yAxis);
</code></pre>
<p>Last, we need to follow a similar process for drawing our lines:</p>
<pre><code class="language-javascript">// remove any previously drawn lines
svg.selectAll(".line").remove();

// draw new lines
const lines = svg.selectAll(".line")
  .data(data)
    .attr("class", "line");

// enter and append these lines
lines.enter().append("path")
  .attr("class", "line")
  .attr("d", line)
  .attr("stroke", "blue");
</code></pre>
<p>And now, we have created our <code>render</code> function. All we need to do is call <code>render</code> and apply a <code>setInterval</code> on this function:</p>
<pre><code class="language-javascript">function render() {
  const data = newData(9, 3);

  const yMin = data.reduce((pv, cv) => {
    const currentMin = cv.reduce((pv, cv) => Math.min(pv, cv.y), 100);
    return Math.min(pv, currentMin);
  }, 100);
  const yMax = data.reduce((pv, cv) => {
    const currentMax = cv.reduce((pv, cv) => Math.max(pv, cv.y), 0)
    return Math.max(pv, currentMax);
  }, 0);

  yScale.domain([yMin, yMax]);

  const yAxis = d3.axisLeft()
    .scale(yScale);

  svg.selectAll(".y.axis").remove();

  svg.append("g")
    .attr("class", "y axis")
    .call(yAxis);

  svg.selectAll(".line")
    .remove();

  const lines = svg.selectAll(".line")
    .data(data)
    .attr("class", "line");

  lines.enter().append("path")
    .attr("class", "line")
    .attr("d", line)
    .attr("stroke", "blue");
}

render();
setInterval(render, 1500);
</code></pre>
<iframe width="480" height="250" src="https://cdn.rawgit.com/jonsadka/6928acb9f561e5a4cbc2/raw/ecb990fcb7796b5d8698dd5d9b2d4f8e6ff7c965/index.html" marginwidth="0" marginheight="0" scrolling="no" align="middle"></iframe>
<h3>Add transitions</h3>
<p>But how do we make this graph beautifully animate and transition? First, let’s take a look at our axis. What we need to do is add a conditional statement to check to see if our scale exists. If so, all we need to do is add a transition to the new yAxis.</p>
<pre><code class="language-javascript">// if no axis exists, create one
if (svg.selectAll(".y.axis").empty()) {
  svg.append("g")
    .attr("class", "y axis")
    .call(yAxis);
// otherwise, update the axis
} else {
  svg.selectAll(".y.axis")
    .transition().duration(1500)
    .call(yAxis);
}
</code></pre>
<p>Now how do we update our lines? What we need to do is select all the lines currently on the page, transition them to the new line with any new attributes or styles, enter the changes in the data, and exit.</p>
<pre><code class="language-javascript">// generate line paths
const lines = svg.selectAll(".line")
  .data(data)
  .attr("class", "line");

// exit
lines.exit()
  .remove();

// enter any new data
lines.enter()
  .append("path")
  .attr("class", "line")
  .attr("d", line)
  .attr("stroke", () =>
    '#' + Math.floor(Math.random() * 16777215).toString(16)
  );

// transition from previous paths to new paths
lines.transition().duration(1500)
  .attr("d", line)
  .attr("stroke", () =>
    '#' + Math.floor(Math.random() * 16777215).toString(16)
  );
</code></pre>
<iframe width="480" height="250" src="https://cdn.rawgit.com/jonsadka/a1b1d1d955220941446f/raw/c14d338163033954c461e9a051cff3ad326b0a33/index.html" marginwidth="0" marginheight="0" scrolling="no"></iframe>
<h3>Complete code</h3>
<p>That’s it! If you’re interested in seeing the complete code, go ahead and check out my bl.ocks: <a href="https://bl.ocks.org/jonsadka/19f1366db3ff25195e650ec90d404092">https://bl.ocks.org/jonsadka/19f1366db3ff25195e650ec90d404092</a></p>
<p>NOTE: Looking for the D3.js v3 tutorial? See it <a href="/blog/how-to-create-live-updating-and-flexible-d3-line-charts-using-pseudo-data/">here</a></p></div></div></div></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-js","jsonName":"blog-how-to-create-live-updating-and-flexible-d-3-line-charts-using-d-3-js-v-5-and-pseudo-data-352","path":"/blog/how-to-create-live-updating-and-flexible-d3-line-charts-using-d3-js-v5-and-pseudo-data"};window.dataPath="313/path---blog-how-to-create-live-updating-and-flexible-d-3-line-charts-using-d-3-js-v-5-and-pseudo-data-352-efb-OiHq33fTSZQtYL5slABzwIx0";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-a383500957aa8d29ea7d.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js.d353a3096505d8eda03e.css","/component---src-templates-blog-post-js-1c631c2dcd091a6f36e2.js"],"component---src-templates-tags-js":["/component---src-templates-tags-js.d353a3096505d8eda03e.css","/component---src-templates-tags-js-773f255cde49bfff7f8c.js"],"component---src-pages-404-js":["/component---src-pages-404-js.d353a3096505d8eda03e.css","/component---src-pages-404-js-61f7255a1602d69ec775.js"],"component---src-pages-tags-js":["/component---src-pages-tags-js-1508b45a6a724b3934f8.js"],"component---src-pages-index-js":["/component---src-pages-index-js-9eec0960e23c922b7db7.js"]};/*]]>*/</script><script src="/webpack-runtime-33cd8964d6e581f59531.js" async=""></script><script src="/app-a383500957aa8d29ea7d.js" async=""></script><script src="/0-f01ddaf1fdf10dc81c90.js" async=""></script><script src="/component---src-templates-blog-post-js-1c631c2dcd091a6f36e2.js" async=""></script></body></html>