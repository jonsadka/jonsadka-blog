<!DOCTYPE html><html><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="preload" href="/component---src-layouts-index-js-a9ab1cf8a2ba6551dd0d.js" as="script"/><link rel="preload" href="/component---src-templates-blog-post-js-28438df4d80dd5e13d89.js" as="script"/><link rel="preload" href="/path---blog-how-to-write-data-to-the-beginning-of-a-file-with-node-javascript-tutorial-and-example-258a38ad3780b7765393.js" as="script"/><link rel="preload" href="/app-29bf3ae6c747aef8726e.js" as="script"/><link rel="preload" href="/commons-ae07a2f8cf734fb55ed3.js" as="script"/><style data-styled-components="ctRCMp kKRaWR kMHpEf">
/* sc-component-id: sc-bdVaJa */
.ctRCMp{font-size:14px;font-weight:700;}
/* sc-component-id: sc-bwzfXH */
.kKRaWR{color:#394047;font-family:'Questrial';font-size:36px;line-height:44px;margin-bottom:1.45rem;}
/* sc-component-id: sc-htpNat */
.kMHpEf{color:#a3a3a3;line-height:20px;font-size:15px;font-family:'Questrial';} .kMHpEf img{border-radius:4px;display:block;margin:10px auto;max-width:734px;width:100%;}</style><title data-react-helmet="true">Jon Sadka - How to write data to the beginning of a file with Node.js / JavaScript (tutorial and example)</title><meta data-react-helmet="true" name="description" content="Jon Sadka&#x27;s Personal Website and Blog"/><meta data-react-helmet="true" name="keywords" content="personal website, blog, sadka, jon, jon sadka, visualization, front end, software engineer, portfolio, visualization, D3.js, JavaScript"/><meta data-react-helmet="true" name="theme-color" content="#333333"/><script>
            
  function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='UA-53344458-1',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-53344458-1', 'auto');
      ga('set', 'anonymizeIp', 1);}
      </script><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#333333"/><style id="gatsby-inlined-css">@import url(https://fonts.googleapis.com/css?family=Libre+Franklin|Questrial);html{font-family:Questrial,sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;color:#1644ce;text-decoration:none;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.45em georgia,serif;box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{color:rgba(0,0,0,.8);font-family:Questrial,georgia,serif;font-weight:400;word-wrap:break-word;-webkit-font-kerning:normal;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";-webkit-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt","kern"}img{margin:0;padding:0}h1{margin:0 0 1.45rem;font-weight:700;font-size:2.25rem;line-height:1.1}h1,h2{padding:0;color:inherit;font-family:Questrial,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;text-rendering:optimizeLegibility}h2{font-size:28px;letter-spacing:.05rem;margin:0 0 30px}h3{font-size:1.38316rem}h3,h4{margin:0 0 1.45rem;padding:0;color:inherit;font-family:Questrial,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{margin:0 0 1.45rem;padding:0;color:inherit;font-family:Questrial,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{margin:0 0 1.45rem;padding:0}ul{margin-right:0;margin-top:0;margin-bottom:1.45rem}ol,ul{padding:0;list-style-position:outside;list-style-image:none}ol{margin:0 0 1.45rem 1.45rem}dd,dl{margin:0 0 1.45rem}dd,dl,p{padding:0}p{margin-left:0;margin-right:0;margin-top:0;color:#a3a3a3;margin-top:30px;font-size:15px}figure{padding:0}figure,pre{margin:0 0 1.45rem}pre{padding:0;font-size:.85rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{margin:0 0 1.45rem;padding:0}blockquote{margin:0 1.45rem 1.45rem;padding:0}form,iframe,noscript{margin:0 0 1.45rem;padding:0}hr,iframe{border:none}hr{margin:0 0 calc(1.45rem - 1px);padding:0;background:rgba(0,0,0,.2);height:1px}address{margin:0 0 1.45rem;padding:0}b,dt,strong,th{font-weight:700}li{color:#a3a3a3;margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:0;padding-top:.2em;padding-bottom:.2em}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{letter-spacing:-.2em;content:" "}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}</style></head><body><div id="___gatsby"><div data-reactroot="" data-reactid="1" data-react-checksum="401401163"><!-- react-empty: 2 --><div style="margin-bottom:1.45rem;" data-reactid="3"><div style="margin:0 auto;max-width:960px;padding:1.45rem 1.0875rem;" data-reactid="4"><div class="sc-bdVaJa ctRCMp" style="margin:0;" data-reactid="5"><a style="color:black;font-family:Libre Franklin;text-decoration:none;" href="/" data-reactid="6">Jon Sadka.</a></div></div></div><div style="margin:0 auto;max-width:960px;padding:0px 1.0875rem 1.45rem;padding-top:0;" data-reactid="7"><div class="blog-post-container" data-reactid="8"><!-- react-empty: 9 --><div class="blog-post" data-reactid="10"><div class="sc-bwzfXH kKRaWR" data-reactid="11">How to write data to the beginning of a file with Node.js / JavaScript (tutorial and example)</div><div class="blog-post-content sc-htpNat kMHpEf" data-reactid="12"><p>Recently I have had to do a lot of work building infrastructure converting data from <code>.json</code> to <code>.csv</code>. One challenge that presented itself was figuring out a way to prepend / write data to the beginning of the <code>.csv</code> file. There are plenty of use cases for prepending information to the beginning of a file, however in my specific use case I needed to count the number of times a variable existed in the <code>.json</code> data so that I could write out that many columns in the header of the <code>.csv</code> file.</p>
<p>The example below creates a <code>.csv</code> file using data extracted from a <code>.json</code> file via Node.js / JavaScript and then writes the header once the desired counts have been determined. To do so, we must first create a temporary file with the converted data (left), create a new file with the generated header (middle), then copy data from the temporary file into the new file (right).</p>
<h3>Part 1 - Variable setup</h3>
<p>We will begin by setting up the variables and functions needed for the task at hand. The header functions have been abstracted and should be written for your specific need(s). Additionally, loading up the entire <code>.json</code> file into memory as depicted in this example has been used for simplicity; implementation of a readstream for reading the <code>.json</code> file would improve performance and allow you to read a larger file.</p>
<pre><code class="language-javascript">// your .json data
var dataArrayJson = [{},{},...,{},{}];
// count of the desired variable
var count = 0;

// your desired function that converts the json data into a .csv row
var convertIntoCsvString = function(data){ return youCsvString; };
// your desired function that counts the number of times something occurs in the dataset
var getCount = function(data){ return dataCount; };

// your desired function that creates a row using the variable count
// i.e. returns something like 'Count-1,Count-2,Count-3' if the count is 3
var createCsvHeaderUsingCount = function(count){ return header; };

// create the writestream for the temporary file
var streamOptions = {flags: 'w', encoding: 'utf8'};
var writeStream = fs.createWriteStream("csvFilename-tmp.csv", streamOptions);
</code></pre>
<h3>Part 2 - <code>.json</code> to <code>.csv</code> conversion</h3>
<p>Once we have the <code>.json</code> data loaded up, we will convert each index in the json array into a comma separated row using our <code>convertIntoCsvString</code> function, add a newline to the end of the row, and write the row to our temporary file <code>csvFilename-tmp.csv</code> using <code>fs.writestream</code>. Additionally, use our <code>getCount</code> function to track how often our deisred event or instance occurs.</p>
<p>Note, some version of <code>async.each</code> should be used to ensure that all the data has been analyzed at and written to the <code>.csv</code> file prior to closing the writestream. If the order of data analysis is significant and there is risk of race conditions to occur, <code>async.eachSeries</code> should be used.</p>
<pre><code class="language-javascript">// loop over each object in the .json data
// the specified limit of 5 is arbitrary but eachLimit is recommended
async.eachLimit(dataArrayJson, 5, function(data, dataCb) {
  var row = convertIntoCsvString(data);
  count = Math.max( count, getCount(data) );

  // write the `.csv` row to the temporary file as a new row
  writeStream.write( row + "\n", 'utf8', function() {
    return dataCb();
  });
}, function(err){
  // close the writestream once done looping through the .json
  // note: async library ensures we have analyzed all the data
  writeStream.close();
});
</code></pre>
<h3>Part 3 - Header creation</h3>
<p>With the desired information in hand, we can now create the custom header using createCsvHeaderUsingCount. The data is read from the temporary file <code>csvFilename-tmp.csv</code>, our header is prepended to this data, and our desired file csvFilename<code>.csv</code> is created. We delete the temporary file using a child process and then are left with our shiny new file ready for consumption.</p>
<pre><code class="language-javascript">var header = createCsvHeaderUsingCount(count);
fs.readFile("csvFilename-tmp.csv", function(err, data) {
  data = header + '\n' + data;
  var newWriteStream = fs.createWriteStream("csvFilename.csv", streamOptions);
  newWriteStream.write(data, 'utf8', function() {
    // remove the temporary file
    childProcess.exec("rm -rf csvFilename-tmp.csv");
  });
});
</code></pre>
<h3>Uncommented code</h3>
<p>Below is the code above condensed with comments removed.</p>
<pre><code class="language-javascript">var dataArrayJson = [{},{},...,{},{}];

var convertIntoCsvString = function(data){ return youCsvString; };
var getCount = function(data){ return dataCount; };
var createCsvHeaderUsingCount = function(count){ return header; };

var count = 0;

var streamOptions = {flags: 'w', encoding: 'utf8'};
var writeStream = fs.createWriteStream("csvFilename-tmp.csv", streamOptions);
async.eachLimit(dataArrayJson, 5, function(data, dataCb) {
  var row = convertIntoCsvString(data);
  count = Math.max( count, getCount(data) );
  writeStream.write( row + "\n", 'utf8', function() {
    return dataCb();
  });
}, function(err){
  writeStream.close();
});

var header = createCsvHeaderUsingCount(count);
fs.readFile("csvFilename-tmp.csv", function(err, data) {
  data = header + '\n' + data;
  var newWriteStream = fs.createWriteStream("csvFilename.csv", streamOptions);
  newWriteStream.write(data, 'utf8', function() {
    childProcess.exec("rm -rf csvFilename-tmp.csv");
  });
});
</code></pre></div></div></div></div></div></div><script id="webpack-manifest">/*<![CDATA[*/window.webpackManifest={"231608221292675":"app-29bf3ae6c747aef8726e.js","107818501498521":"component---src-templates-blog-post-js-28438df4d80dd5e13d89.js","50739212244294":"component---src-templates-tags-js-c0356a12f1f284ded8a8.js","162898551421021":"component---src-pages-404-js-b3e7ca0012663ba8421b.js","195850678278728":"component---src-pages-tags-js-74c6a6040eb0865ab482.js","35783957827783":"component---src-pages-index-js-268c01eccdea00eb2c93.js","60335399758886":"path----557518bd178906f8d58a.js","274534309317194":"path---blog-how-to-create-live-updating-and-flexible-d-3-line-charts-using-d-3-js-v-5-and-pseudo-data-ce106858f9a36725872a.js","79800021609243":"path---blog-how-to-debug-a-chrome-specific-bug-on-ios-using-remote-debugging-223b9b707a1af79ed633.js","152214329170102":"path---blog-choosing-the-best-numbers-in-nfl-football-squares-to-beat-your-friends-2e5a07eb7b74a64c8a53.js","133690226149412":"path---blog-how-to-generate-time-series-week-over-week-year-over-year-aggregations-in-mongodb-using-unix-epoch-timestamps-tutorial-and-example-ed016f43e0a4d2c38733.js","95233356588121":"path---blog-how-to-write-data-to-the-beginning-of-a-file-with-node-javascript-tutorial-and-example-258a38ad3780b7765393.js","206168194320328":"path---blog-how-apple-can-catch-up-to-google-ratings-and-yelp-reviews-overnight-27d83a8616a94e7f0faf.js","195169542730238":"path---blog-best-and-worst-times-to-take-an-uber-93d0c72ae150a640b82a.js","4529161709811":"path---blog-how-to-create-adaptive-pie-charts-with-transitions-in-d-3-fa14a5a9d91d7087cde2.js","131182293433081":"path---blog-how-to-create-live-updating-and-flexible-d-3-line-charts-using-pseudo-data-7ac340dff1689aa85411.js","59333814150904":"path---blog-how-to-modify-filter-and-save-json-files-locally-using-jquery-38d2155524508e26f96d.js","42882386469154":"path---blog-how-to-quickly-create-randomly-generated-datasets-in-javascript-with-d-3-2098e6849f3252e8ee4b.js","273029797402817":"path---blog-using-reduce-to-create-arrays-and-objects-in-javascript-45d0856eb9f74d3b96c0.js","185792110582549":"path---blog-how-to-use-the-uber-api-to-get-pricing-data-f2e6dfc4a25b69f5d8ec.js","19075071473338":"path---blog-fight-on-the-power-of-javascript-closures-4e105a17992e60540dc9.js","100982722209036":"path---blog-prototypal-and-pseudoclassical-instantiation-in-javascript-4059287abb9f36399610.js","268645148262682":"path---blog-type-coercion-in-d-3-js-fd87c1759ded40b41ebf.js","133865716084565":"path---blog-supercharge-your-falsey-conditional-statements-in-javascript-39da70760aea44b9ed25.js","127501106087498":"path---tags-d-3-js-b69dde57f7061ba58040.js","212641908305216":"path---tags-java-script-d0dfd378010137636fe7.js","32135422922473":"path---tags-mongo-db-8a3f7a07e6a3de92fa33.js","4836336648314":"path---tags-ux-ui-a32ac5042b2af955d093.js","155610972471906":"path---tags-api-4bd6b0853b50a4b7196b.js","235634758467862":"path---tags-j-query-269370f4792876ec252c.js","254022195166212":"path---404-a0e39f21c11f6a62c5ab.js","55702396619907":"path---tags-8467056c52b28d623dc2.js","178698757827068":"path---404-html-a0e39f21c11f6a62c5ab.js","142629428675168":"path---index-7ecc05f3a9957675d6d7.js","114276838955818":"component---src-layouts-index-js-a9ab1cf8a2ba6551dd0d.js"}/*]]>*/</script><script>/*<![CDATA[*/["/commons-ae07a2f8cf734fb55ed3.js","/app-29bf3ae6c747aef8726e.js","/path---blog-how-to-write-data-to-the-beginning-of-a-file-with-node-javascript-tutorial-and-example-258a38ad3780b7765393.js","/component---src-templates-blog-post-js-28438df4d80dd5e13d89.js","/component---src-layouts-index-js-a9ab1cf8a2ba6551dd0d.js"].forEach(function(s){document.write('<script src="'+s+'" defer></'+'script>')})/*]]>*/</script></body></html>